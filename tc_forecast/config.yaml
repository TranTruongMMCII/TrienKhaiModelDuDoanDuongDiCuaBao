# TC Forecast Configuration
# Based on: "Forecasting tropical cyclone tracks in the northwestern Pacific
# based on a deep-learning model" (GMD, 2023)
# Paper: https://gmd.copernicus.org/articles/16/2167/2023/

data:
  # Data paths (relative to tc_forecast folder or absolute)
  # IBTrACS track data
  ibtracs_path: '../data/IBTrACS_Cleaned_Data_v2.csv'
  # Atmospheric data directory containing period folders (2020-2024, 2025-2029, etc.)
  # Each period folder has sst/, uv/, z/ subfolders
  atmospheric_data_dir: '../data'
  # Column mappings for IBTrACS_Cleaned_Data.csv
  columns:
    storm_id: 'STORM_ID'
    name: 'NAME'
    timestamp: 'ISO_TIME'
    latitude: 'LAT'
    longitude: 'LONG'
    storm_direction: 'STORM_DIR'
    storm_speed: 'STORM_SPEED'
    wind_speed: 'WMO_WIND'
    pressure: 'WMO_PRE'
    landfall: 'LANDFALL'
  # ===== 19 RAW FEATURES (computed from IBTrACS) =====
  # These are derived from basic IBTrACS columns, not directly read
  all_19_features:
    - 'LAT' # Current latitude
    - 'LON' # Current longitude
    - 'WS' # Wind speed (knots)
    - 'P' # Pressure (hPa)
    - 'DIS' # Distance from last point (km)
    - 'ANG' # Angle from equator (degrees)
    - 'SPEED' # Storm translation speed (km/h)
    - 'DIRECT' # Storm direction (degrees from north)
    - 'F2' # Coriolis parameter (2*omega*sin(lat))
    - 'DIF_LAT' # Change in latitude
    - 'DIF_LON' # Change in longitude
    - 'X_DIST' # East-west distance (km)
    - 'Y_DIST' # North-south distance (km)
    - 'U' # Zonal velocity component
    - 'V' # Meridional velocity component
    - 'DIF_WS' # Change in wind speed
    - 'DIF_P' # Change in pressure
    - 'DIF_SPEED' # Change in translation speed
    - 'DIF_DIRECT' # Change in direction
  # ===== TOP 11 FEATURES (selected by Random Forest) =====
  # Importance ranking from paper: ANG > LON > DIF_DIRECT > X_DIST > DIF_LON > LAT > DIF_SPEED > F2 > Y_DIST > P > WS
  top_11_features:
    - 'ANG'
    - 'LON'
    - 'DIF_DIRECT'
    - 'X_DIST'
    - 'DIF_LON'
    - 'LAT'
    - 'DIF_SPEED'
    - 'F2'
    - 'Y_DIST'
    - 'P'
    - 'WS'
  # Which feature set to use
  # If true, use top 11 features; if false, use all 19
  use_top_11: true
  # Environmental data configuration
  environmental:
    # UV: Wind components at 4 pressure levels × 2 components = 8 channels
    # Grid size: 21×21 around storm center (10°×10° area)
    uv:
      channels: 8
      height: 21
      width: 21
      variables:
        ['u300', 'u500', 'u700', 'u850', 'v300', 'v500', 'v700', 'v850']

    # SST: Sea Surface Temperature - 1 channel
    # Grid size: 21×21 around storm center
    sst:
      channels: 1
      height: 21
      width: 21

    # Z: Geopotential height at 3 levels = 3 channels
    # Grid size: 46×81 (larger area)
    z:
      channels: 3
      height: 46
      width: 81
      variables: ['z300', 'z500', 'z700']
  # Sequence configuration
  sequence_length: 8 # 8 timesteps input (24 hours at 3h intervals)
  forecast_steps: 12 # 12 forecast steps
  time_interval: 6 # 6 hours between forecast outputs
  max_forecast_hours: 72 # Maximum forecast horizon
  # Key forecast hours for evaluation
  key_forecast_hours: [24, 48, 72] # 24h, 48h, 72h forecasts
  # Data split by year (paper methodology)
  split_by_year: true
  train_years: [2015, 2022] # Training: 2020-2023
  val_years: [2023, 2023] # Validation: 2024
  test_years: [2024, 2026] # Test: 2025-2026
  # Alternative ratio-based split (if split_by_year is false)
  train_ratio: 0.7
  val_ratio: 0.15
  test_ratio: 0.15
  # Normalization
  normalize: true
  normalization_method: 'minmax' # minmax or standard

model:
  type: 'GRU_CNN' # Options: "GRU", "GRU_CNN"
  # ===== GRU Branch Configuration (for track data) =====
  gru:
    hidden_units: [128, 32]
    dropout: 0.2
    recurrent_dropout: 0.0
    return_sequences: [true, false]
    activation: 'relu'
    learning_rate: 0.001 # Separate learning rate for GRU branch
  # ===== CNN Branches Configuration (for environmental data) =====
  # UV CNN: 8 input channels → Conv2D layers
  cnn_uv:
    filters: [32, 64, 128]
    kernel_sizes: [[3, 3], [3, 3], [3, 3]]
    pool_sizes: [[2, 2], [2, 2], [2, 2]]
    activation: 'relu'
    dropout: 0.2
    learning_rate: 0.0001 # Lower LR for CNN branches
  # SST CNN: 1 input channel
  cnn_sst:
    filters: [16, 32, 64]
    kernel_sizes: [[3, 3], [3, 3], [3, 3]]
    pool_sizes: [[2, 2], [2, 2], [2, 2]]
    activation: 'relu'
    dropout: 0.2
    learning_rate: 0.0001
  # Z (Geopotential) CNN: 3 input channels, larger grid (46×81)
  cnn_z:
    filters: [32, 64, 128]
    kernel_sizes: [[3, 3], [3, 3], [3, 3]]
    pool_sizes: [[2, 2], [2, 2], [2, 2]]
    activation: 'relu'
    dropout: 0.2
    learning_rate: 0.0001
  # Dense layers after concatenation
  dense:
    units: [128, 64]
    activation: 'relu'
    dropout: 0.3
  # Output layer: 12 steps × 2 (lat/lon offsets) = 24 values
  output:
    units: 24 # 12 forecast steps × 2 (lat, lon)
    activation: 'linear'

training:
  batch_size: 32
  epochs: 100
  # Multi-optimizer configuration (paper uses different LR per branch)
  use_multi_optimizer: true
  optimizer:
    type: 'adam'
    # Global learning rate (used if use_multi_optimizer is false)
    learning_rate:
      initial: 0.001
      decay_steps: 2280 # From paper
      decay_rate: 0.92
      schedule: 'exponential'
  # Loss function
  loss: 'mse'
  metrics: ['mae', 'mse']
  # Callbacks
  callbacks:
    early_stopping:
      enabled: true
      monitor: 'val_loss'
      patience: 15
      restore_best_weights: true

    model_checkpoint:
      enabled: true
      monitor: 'val_loss'
      save_best_only: true
      filepath: './checkpoints/gru_cnn_best.weights.h5'

    reduce_lr:
      enabled: true
      monitor: 'val_loss'
      factor: 0.5
      patience: 5
      min_lr: 1e-7

evaluation:
  metrics:
    - 'rmse'
    - 'mae'
    - 'distance_error' # Haversine distance in km
  per_timestep: true
  plot_results: true
  save_predictions: true
  output_path: './results'

# Reproducibility
seed: 325

# Physical constants
constants:
  earth_radius_km: 6371.0
  omega: 0.00007292 # Earth's angular velocity (rad/s)
